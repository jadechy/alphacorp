{% extends 'base.html.twig' %}

{% block title %}Évènements{% endblock %}

{% block body %}
<main class="flex-1 py-10 px-5 sm:px-10">    
        <section>
            <div class="flex flex-row items-center space-x-6">
                <h1 class="text-lg font-medium text-black">Évènements <span class="font-bold text-blue-600">{{event.title}}</span></h1>
                {% if event.author.id != app.user.id %}
                    {% if event.isInFuture() %}
                        <div class="w-full bg-green-500/30 text-green-500 rounded-lg mt-4">
                            <p class="p-4">Cet évènement n'a pas encore commencé, vous pouvez encore y participer. </p>
                        </div>
                    {% elseif event.isOngoing() %}
                        <div class="w-full bg-orange-500/30 text-orange-500 rounded-lg mt-4">
                            <p class="p-4">Cet évènement est en cours.</p>
                        </div>
                    {% elseif event.isFinished() %}
                        <div class="w-full bg-red-500/30 text-red-500 rounded-lg mt-4">
                            <p class="p-4">Cet évènement est fini.</p>
                        </div>
                    {% endif %}
                {% else %}
                    {% if event.isInFuture() %}
                        <span class="py-1.5 px-2.5 bg-green-500/30 rounded-full flex w-20 justify-center items-center gap-1">
                            <p class="font-medium text-xs text-green-600">Ouvert</p>
                        </span>
                    {% elseif event.isFinished() %}
                        <span class="py-1.5 px-2.5 bg-red-500/30 rounded-full flex w-20 justify-center items-center gap-1">
                            <p class="font-medium text-xs text-red-600">Fermé</p>
                        </span>
                    {% elseif event.isOngoing() %}
                        <span class="py-1.5 px-2.5 bg-orange-500/30 rounded-full flex w-20 justify-center items-center gap-1">
                            <p class="font-medium text-xs text-orange-600">En cours</p>
                        </span>
                    {% endif %}
                {% endif %}
            </div>

            <div>
                <p>{{event.longDescription}}</p>

                <h4>Date</h4>
                <p>Du {{ event.startAt|format_datetime('short', 'none', locale: 'fr') }} au {{ event.endAt|format_datetime('short', 'none', locale: 'fr') }}</p>

                <h4>Lieu</h4>
                <p>{{event.location}}</p>

                {% if event.author.id != app.user.id %}
                    <p>Par {{event.author.username}}</p>
                {% endif %}

                <p class="text-center">Il y a : <span class="font-semibold">{{ event.participants|length }}</span> participants</p>
            </div>

            {% if event.author.id != app.user.id and 'ROLE_ADMIN' not in app.user.roles and event.isInFuture() %}
                {% if isParticipating %}
                    <p class="text-green-600 font-medium mt-5">Vous participez déjà à cet événement.</p>
                    <a href="{{ path('unparticipate_event', { id: event.id }) }}">
                        <button type="submit" class="relative mt-5 bg-red-700 flex-row p-2 items-center justify-center rounded-md text-sm overflow-hidden border cursor-pointer transition text-white hover:opacity-90 hover:scale-105 w-fit">
                            Ne plus participer
                        </button>
                    </a>
                {% else %}
                    <a href="{{ path('participate_event', { id: event.id }) }}">
                        <button type="submit" class="relative mt-5 bg-blue-700 flex-row p-2 items-center justify-center rounded-md text-sm overflow-hidden border cursor-pointer transition text-white hover:opacity-90 hover:scale-105 w-fit">
                            {{ button_label|default('Participer') }}
                        </button>
                    </a>
                {% endif %}
            {% endif %}

            <div>
                {% if event.author.id == app.user.id or 'ROLE_ADMIN' in app.user.roles %}
                    {% for participant in event.participants %}
                        <div>
                            <p>{{participant.username}}</p>
                        </div>
                    {% endfor %}

                    {{ include('event/_delete_form.html.twig') }}
                {% endif %}
            </div>

            
        </section>
    </main>
{% endblock %}
